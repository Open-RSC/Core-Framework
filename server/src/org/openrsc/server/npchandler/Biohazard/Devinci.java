/**
* Generated By NPCScript :: A scripting engine created for openrsc by Zilent
*/
//npc ID 507
package org.openrsc.server.npchandler.Biohazard;
import org.openrsc.server.Config;
import org.openrsc.server.event.DelayedQuestChat;
import org.openrsc.server.event.SingleEvent;
import org.openrsc.server.model.MenuHandler;
import org.openrsc.server.model.Npc;
import org.openrsc.server.model.Player;
import org.openrsc.server.model.Quest;
import org.openrsc.server.model.Quests;
import org.openrsc.server.model.World;
import org.openrsc.server.npchandler.NpcHandler;


public class Devinci implements NpcHandler
 {
	int wrongPot = 0;
	int correctPot = 0;
	
	public void handleNpc(final Npc npc, final Player owner) throws Exception
	{
		npc.blockedBy(owner);
		owner.setBusy(true);
		
		Quest q = owner.getQuest(Quests.BIOHAZARD);
		
		if(q != null) 
		{	
			if(owner.getQuest(Quests.BIOHAZARD) != null && owner.getQuest(Quests.BIOHAZARD).getStage() == 7)
			{
				questStage7(npc, owner);
			}
			else
			{
				owner.sendMessage("Devinci seems to be too busy to talk");
				owner.setBusy(false);
				npc.unblock();
			}	
		} 
		else
		{
			owner.sendMessage("Devinci seems to be too busy to talk");
			owner.setBusy(false);
			npc.unblock();
		}
	}
	
	private void questStage7(final Npc npc, final Player owner) 
	{
		
		if (owner.getX() <= 94) //change coords to varrock location
		{
			World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Hello again", "I hope your journey was as pleasant as mine"}, true)
			{
				public void finished()
				{
					World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Well, it's always sunny in Runescape, as they say"})
					{
						public void finished()
						{
							if (correctPot == 1)
							{
								World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Ok, here it is"})
								{
									public void finished()
									{
										owner.sendMessage("He gives you the vial of ethenea");
										owner.getInventory().add(810, 1);
										owner.sendInventory();
										World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Thanks, you've been a big help"})
										{
											public void finished()
											{
												correctPot--;
												owner.setBusy(false);
												npc.unblock();
											}
										});
									}
								});
							}
							else if (wrongPot == 1)
							{
								World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"It seems that I have lost the vial that you gave me", "I am sorry"})
								{
									public void finished()
									{
										wrongPot--;
										owner.setBusy(false);
										npc.unblock();
									}
								});
							}
							else
							{
								owner.setBusy(false);
								npc.unblock();
							}
						}
					});
				}
			});
		}
		else
		{
			if (correctPot == 1 || wrongPot == 1)
			{
				World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"I'll meet you at the dancing donkey in Varrock"}, true)
				{
					public void finished()
					{
						owner.setBusy(false);
						npc.unblock();
					}
				});
			}
			else
			{
				World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Hello, I hear you're an errand boy for the chemist"}, true)
				{
					public void finished()
					{
						World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Well that's my day job yes", "But I don't necessarily define my identity in such black and white terms"})
						{
							public void finished()
							{
								World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Good for you", "Now can you take a vial to Varrock for me?"})
								{
									public void finished()
									{
										World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Go on then"})
										{
											public void finished()
											{
												World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
												{
													public void action()
													{
														final String[] options107 = {"Give him the vial of ethenea", "Give him the vial of liquid honey", "Give him the vial of sulphuric broline"};
														owner.setBusy(false);
														owner.sendMenu(options107);
														owner.setMenuHandler(new MenuHandler(options107) 
														{
															public void handleReply(final int option, final String reply)
															{
																owner.setBusy(true);
																switch(option) 
																{
																	case 0:
																		if(owner.getInventory().countId(810) == 0)
																		{
																			owner.sendMessage("You dont have a vial of ethernea to give");
																			owner.setBusy(false);
																			npc.unblock();
																		}
																		else
																		{
																			correctPot++;
																			owner.getInventory().remove(810, 1);
																			owner.sendInventory();
																			owner.sendMessage("You give him the vial of ethernea");
																			World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Ok, We're meeting at the dancing donkey in Varrock right?"})
																			{
																				public void finished()
																				{
																					World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"That's right"})
																					{
																						public void finished()
																						{
																							owner.setBusy(false);
																							npc.unblock();
																						}
																					});
																				}
																			});
																		}
																	break;
																	case 1:
																		if(owner.getInventory().countId(809) == 0)
																		{
																			owner.sendMessage("You dont have a vial of liquid honey to give");
																			owner.setBusy(false);
																			npc.unblock();
																		}
																		else
																		{
																			wrongPot++;
																			owner.getInventory().remove(809, 1);
																			owner.sendInventory();
																			owner.sendMessage("You give him the vial of liquid honey");
																			World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Ok, We're meeting at the dancing donkey in Varrock right?"})
																			{
																				public void finished()
																				{
																					World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"That's right"})
																					{
																						public void finished()
																						{
																							owner.setBusy(false);
																							npc.unblock();
																						}
																					});
																				}
																			});
																		}
																	break;
																	case 2:
																		if(owner.getInventory().countId(811) == 0)
																		{
																			owner.sendMessage("You dont have a vial of sulphuric broline to give");
																			owner.setBusy(false);
																			npc.unblock();
																		}
																		else
																		{
																			wrongPot++;
																			owner.getInventory().remove(811, 1);
																			owner.sendInventory();
																			owner.sendMessage("You give him the vial of sulphuric broline");
																			World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Ok, We're meeting at the dancing donkey in Varrock right?"})
																			{
																				public void finished()
																				{
																					World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"That's right"})
																					{
																						public void finished()
																						{
																							owner.setBusy(false);
																							npc.unblock();
																						}
																					});
																				}
																			});
																		}
																	break;
																}
															}
														});
													}
												});
											}
										});
									}
								});
							}
						});
					}
				});
			}	
		}
	}
	
}