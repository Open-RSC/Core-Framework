/**
* Generated By NPCScript :: A scripting engine created for openrsc by Zilent
*/
//npc ID 445
package org.openrsc.server.npchandler.Plague_City;
import org.openrsc.server.Config;
import org.openrsc.server.event.DelayedQuestChat;
import org.openrsc.server.event.SingleEvent;
import org.openrsc.server.model.ChatMessage;
import org.openrsc.server.model.InvItem;
import org.openrsc.server.model.MenuHandler;
import org.openrsc.server.model.Npc;
import org.openrsc.server.model.Player;
import org.openrsc.server.model.Quest;
import org.openrsc.server.model.World;
import org.openrsc.server.npchandler.NpcHandler;



public class Mourner2 implements NpcHandler
 {

	public void handleNpc(final Npc npc, final Player owner) throws Exception
	{
		npc.blockedBy(owner);
		owner.setBusy(true);
		Quest q = owner.getQuest(Config.Quests.PLAGUE_CITY);
		if(q != null) 
		{
			if(q.finished()) 
			{
				noQuestStarted(npc, owner);
			}
			else 
			{
				switch(q.getStage())
				{
					default:
						noQuestStarted(npc, owner);
				}
			}
		} 
		else 
		{
			noQuestStarted(npc, owner);
		}
	}
	
	private void noQuestStarted(final Npc npc, final Player owner)
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"hmm how did you get over here?", "You're not one of this rabble", "Ah well you'll have to stay", "Can't risk you going back now"}, true)
		{
			public void finished()
			{	
				World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
				{
					public void action()
					{
						final String[] options107 = {"So what's a mourner?", "I've not got the plague though", "I'm looking for a woman named Elena"};
						owner.setBusy(false);
						owner.sendMenu(options107);
						owner.setMenuHandler(new MenuHandler(options107) 
						{
							public void handleReply(final int option, final String reply)
							{
								owner.setBusy(true);
								for(Player informee : owner.getViewArea().getPlayersInView())
								{
									informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
								}
								switch(option) 
								{
									case 0:
										mournerInfo(npc, owner);
									break;
									case 1:
										noPlague(npc, owner);
									break;
									case 3:
										elena(npc, owner);
									break;
								}
							}
						});
					}
				});			
			}
		});
	}
	
	private void mournerInfo(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"We're working for King Luthas of East Ardougne", "Trying to contain the accursed plague sweeping west Ardougne", "We also do our best to ease these peoples suffering", "We're nicknamed mourners", "Because we spend a lot of time at plague victims funerals", "No one else is allowed to risk the funerals", "It's a demanding job", "And we get little thanks from the people here"}) 
		{
			public void finished()
			{
				owner.setBusy(false);
				npc.unblock();	
			}
		});
	}
	
	private void noPlague(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Can't risk you being a carrier", "that protective clothing you have", "is a regulation issue", "It wont meet safety standards"}) 
		{
			public void finished()
			{
				owner.setBusy(false);
				npc.unblock();	
			}
		});
	}
	
	private void elena(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Ah yes I've heard of her", "A missionary I believe", "She must be mad coming over here voluntarily", "I hear rumours she has probably caught the plague now", "Very tragic stupid waste of life"}) 
		{
			public void finished()
			{
				owner.setBusy(false);
				npc.unblock();	
			}
		});
	}
	
}