/**
* Generated By NPCScript :: A scripting engine created for openrsc by Zilent
*/
//npc ID 469
package org.openrsc.server.npchandler.Plague_City;
import org.openrsc.server.Config;
import org.openrsc.server.event.DelayedQuestChat;
import org.openrsc.server.event.SingleEvent;
import org.openrsc.server.model.ChatMessage;
import org.openrsc.server.model.InvItem;
import org.openrsc.server.model.MenuHandler;
import org.openrsc.server.model.Npc;
import org.openrsc.server.model.Player;
import org.openrsc.server.model.Quest;
import org.openrsc.server.model.Quests;
import org.openrsc.server.model.World;
import org.openrsc.server.npchandler.NpcHandler;



public class Head_Mourner implements NpcHandler
 {

	public void handleNpc(final Npc npc, final Player owner) throws Exception
	{
		npc.blockedBy(owner);
		owner.setBusy(true);
		Quest q = owner.getQuest(Quests.PLAGUE_CITY);
		if(q != null) 
		{
			if(q.finished()) 
			{
				noQuestStarted(npc, owner);
			}
			else 
			{
				switch(q.getStage())
				{
					case 8:
						questStage8(npc, owner);
					break;
					default:
						noQuestStarted(npc, owner);
				}
			}
		} 
		else 
		{
			noQuestStarted(npc, owner);
		}
	}
	
	private void noQuestStarted(final Npc npc, final Player owner)
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"How did you get into West Ardougne?", "You're not one of this rabble", "Ah well you'll have to stay", "Can't risk you spreading the plague outside"}, true)
		{
			public void finished()
			{	
				World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
				{
					public void action()
					{
						final String[] options107 = {"So what's a mourner?", "I've not got the plague though", "I'm looking for a woman named Elena"};
						owner.setBusy(false);
						owner.sendMenu(options107);
						owner.setMenuHandler(new MenuHandler(options107) 
						{
							public void handleReply(final int option, final String reply)
							{
								owner.setBusy(true);
								for(Player informee : owner.getViewArea().getPlayersInView())
								{
									informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
								}
								switch(option) 
								{
									case 0:
										mournerInfo(npc, owner);
									break;
									case 1:
										noPlague(npc, owner);
									break;
									case 2:
										elena(npc, owner);
									break;
								}
							}
						});
					}
				});			
			}
		});
	}
	
	private void mournerInfo(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"We're working for King Luthas of East Ardougne", "Trying to contain the accursed plague sweeping west Ardougne", "We also do our best to ease these peoples suffering", "We're nicknamed mourners", "Because we spend a lot of time at plague victims funerals", "No one else is allowed to risk the funerals", "It's a demanding job", "And we get little thanks from the people here"}) 
		{
			public void finished()
			{
				owner.setBusy(false);
				npc.unblock();	
			}
		});
	}
	
	private void noPlague(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Can't risk you being a carrier", "that protective clothing you have", "is a regulation issue", "It wont meet safety standards"}) 
		{
			public void finished()
			{
				owner.setBusy(false);
				npc.unblock();	
			}
		});
	}
	
	private void elena(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Ah yes I've heard of her", "A missionary I believe", "She must be mad coming over here voluntarily", "I hear rumours she has probably caught the plague now", "Very tragic stupid waste of life"}) 
		{
			public void finished()
			{
				owner.setBusy(false);
				npc.unblock();	
			}
		});
	}
	
	private void questStage8(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"How did you get into West Ardougne?", "You're not one of this rabble", "Ah well you'll have to stay", "Can't risk you spreading the plague outside"}, true)
		{
			public void finished()
			{	
				World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
				{
					public void action()
					{
						final String[] options107 = {"I need clearance to enter a plague house", "So what's a mourner?", "I've not got the plague though", "I'm looking for a woman named Elena"};
						owner.setBusy(false);
						owner.sendMenu(options107);
						owner.setMenuHandler(new MenuHandler(options107) 
						{
							public void handleReply(final int option, final String reply)
							{
								owner.setBusy(true);
								for(Player informee : owner.getViewArea().getPlayersInView())
								{
									informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
								}
								switch(option) 
								{
									case 0:
										clearance(npc, owner);
									break;
									case 1:
										mournerInfo(npc, owner);
									break;
									case 2:
										noPlague(npc, owner);
									break;
									case 3:
										elena(npc, owner);
									break;
								}
							}
						});
					}
				});			
			}
		});
	}
	
	private void clearance(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"It's in the southeast corner of west ardougne"}) 
		{
			public void finished()
			{
				World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"You must be nuts, absolutely not"}) 
				{
					public void finished()
					{
						World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
						{
							public void action()
							{
								final String[] options107 = {"There's a kidnap victim inside", "I've got a gasmask though", "Yes I'm utterly crazy"};
								owner.setBusy(false);
								owner.sendMenu(options107);
								owner.setMenuHandler(new MenuHandler(options107) 
								{
									public void handleReply(final int option, final String reply)
									{
										owner.setBusy(true);
										for(Player informee : owner.getViewArea().getPlayersInView())
										{
											informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
										}
										switch(option) 
										{
											case 0:
												kidnapVictim(npc, owner);
											break;
											case 1:
												gasMask(npc, owner);
											break;
											case 2:
												soCrazy(npc, owner);
											break;
										}
									}
								});
							}
						});	
					}
				});
			}
		});
	}
	
	private void kidnapVictim(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Well they're as good as dead already then", "No point trying to save them"}) 
		{
			public void finished()
			{
				owner.setBusy(false);
				npc.unblock();	
			}
		});
	}
	
	private void gasMask(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"It's not regulation", "Anyway you're not properly trained to deal with the plague"}) 
		{
			public void finished()
			{
				World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"How do I get trained?"}) 
				{
					public void finished()
					{
						World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"It requires a strict 18 months of training"}) 
						{
							public void finished()
							{
								World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"I don't have that sort of time"}) 
								{
									public void finished()
									{
										owner.setBusy(false);
										npc.unblock();	
									}
								});
							}
						});
					}
				});
			}
		});
	}
	
	private void soCrazy(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"You waste my time", "I have much work to do"}) 
		{
			public void finished()
			{
				owner.setBusy(false);
				npc.unblock();	
			}
		});
	}
	
}