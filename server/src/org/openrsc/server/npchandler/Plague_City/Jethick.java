/**
* Generated By NPCScript :: A scripting engine created for openrsc by Zilent
*/
//npc ID 443
package org.openrsc.server.npchandler.Plague_City;
import org.openrsc.server.Config;
import org.openrsc.server.event.DelayedQuestChat;
import org.openrsc.server.event.SingleEvent;
import org.openrsc.server.model.ChatMessage;
import org.openrsc.server.model.InvItem;
import org.openrsc.server.model.MenuHandler;
import org.openrsc.server.model.Npc;
import org.openrsc.server.model.Player;
import org.openrsc.server.model.Quest;
import org.openrsc.server.model.World;
import org.openrsc.server.npchandler.NpcHandler;



public class Jethick implements NpcHandler 
{

	public void handleNpc(final Npc npc, final Player owner) throws Exception 
	{
		npc.blockedBy(owner);
		owner.setBusy(true);
		Quest q = owner.getQuest(Config.Quests.PLAGUE_CITY);
		if(q != null) 
		{
			if(q.finished())
			{
				finished(npc, owner);
			} 
			else 
			{
				switch(q.getStage())
				{
					case 6:
						questStage6(npc, owner);
						break;
					default:
						noQuestStarted(npc, owner);
				}
			}
		} 
		else
		{
			noQuestStarted(npc, owner);
		}
	}
	
	private void questStage6(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Hello I don't recognise you", "We don't get many newcomers around here"}, true) 
		{
			public void finished()
			{
				World.getDelayedEventHandler().add(new SingleEvent(owner, 1500) 
				{
					public void action() 
					{
						final String[] options107 = {"Hi I'm looking for a woman from east Ardougne", "So who's in charge here?"};
						owner.setBusy(false);
						owner.sendMenu(options107);
						owner.setMenuHandler(new MenuHandler(options107)
						{
							public void handleReply(final int option, final String reply)
							{
								owner.setBusy(true);
								for(Player informee : owner.getViewArea().getPlayersInView())
								{
									informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
								}
								switch(option) 
								{
									case 0:
										elena(npc, owner);
									break;
									case 2:
										whoInCharge(npc, owner);
									break;
								}
							}
						});
					}
				});
			}
		});
	}
	
	private void whoInCharge(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Well King Tyras has wandered off into the west kingdom", "He doesn't care about the mess he's left here", "The city warder Bravek is in charge at the moment", "He's not much better"}) 
		{
			public void finished()
			{
				owner.setBusy(false);
				npc.unblock();	
			}
		});
	}
	
	private void elena(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"East Ardougnian women are easier to find in east Ardougne", "Not many would come to west Ardougne to find one", "Any particular woman you have in mind?"}) 
		{
			public void finished()
			{
				World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"Yes a lady called Elena"}) 
				{
					public void finished()
					{
						World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"What does she look like?"}) 
						{
							public void finished()
							{
								if(owner.getInventory().countId(767) > 0)
								{
									owner.sendMessage("You show the picture to Jethick");
									World.getDelayedEventHandler().add(new SingleEvent(owner, 2000) 
									{
										public void action() 
										{
											if(owner.getInventory().countId(768) > 0)
											{
												World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Ah yes I recognise her", "She was over here to help aid plague victims", "I think she is staying over with the Rehnison family", "They live in the small timbered building at the far northside of town", "I've not seen her around here in a while mind you"}) 
												{
													public void finished()
													{
														owner.setBusy(false);
														npc.unblock();
													}
												});
											}
											else
											{
												World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Ah yes I recognise her", "She was over here to help aid plague victims", "I think she is staying over with the Rehnison family", "They live in the small timbered building at the far northside of town", "I've not seen her around here in a while mind you", "I don't suppose you could run me a little errand?", "While you are over there", "I borrowed this book from them", "Can you return it?"}) 
												{
													public void finished()
													{
														owner.sendMessage("Jethick gives you a book");
														owner.getInventory().add(768, 1);
														owner.sendInventory();
														owner.setBusy(false);
														npc.unblock();	
													}
												});
											}
										}
									});
								}
								else
								{
									World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"I'm not sure actually"}) 
									{
										public void finished()
										{
											World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Maybe you should find a picture of her"}) 
											{
												public void finished()
												{
													owner.setBusy(false);
													npc.unblock();
												}
											});
										}
									});
								}
							}
						});
					}	
				});		
			}
		});
	}
	
	private void finished(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
		{
			public void action()
			{
				owner.sendMessage("Jethick is not interested in talking");
				owner.setBusy(false);
				npc.unblock();
			}
		});
	}
	
	private void noQuestStarted(final Npc npc, final Player owner) 
	{
		World.getDelayedEventHandler().add(new SingleEvent(owner, 2000)
		{
			public void action()
			{
				owner.sendMessage("Jethick is not interested in talking");
				owner.setBusy(false);
				npc.unblock();
			}
		});
	}
	
}