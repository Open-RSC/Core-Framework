/**
* Generated By NPCScript :: A scripting engine created for RSCEmulation by Zilent

script put together by Mr.Zain
*/
package org.rscemulation.server.npchandler;

import org.rscemulation.server.event.DelayedQuestChat;
import org.rscemulation.server.event.SingleEvent;
import org.rscemulation.server.model.ChatMessage;
import org.rscemulation.server.model.MenuHandler;
import org.rscemulation.server.model.Npc;
import org.rscemulation.server.model.Player;
import org.rscemulation.server.model.World;
import org.rscemulation.server.npchandler.NpcHandler;

public class Monk_of_Entrana implements NpcHandler {
	
	public void handleNpc(final Npc npc, final Player owner) {
		npc.blockedBy(owner);
		owner.setBusy(true);
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Greetings", "Do you seek passage to our holy island?"}, true) {
			public void finished() {
				World.getDelayedEventHandler().add(new SingleEvent(owner, 1500) {
					public void action() {
						final String[] options107 = {"Yes please", "No thanks"};
						owner.setBusy(false);
						owner.sendMenu(options107);
						owner.setMenuHandler(new MenuHandler(options107) {
							public void handleReply(final int option, final String reply) {
								owner.setBusy(true);
								for(Player informee : owner.getViewArea().getPlayersInView()) {
									informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
								}
								switch(option) {
									case 0:
										accept(npc, owner);
										owner.setBusy(false);
										break;
									case 1:
										decline(npc, owner);
										owner.setBusy(false);
										break;
								}
							}
						});
					}
				});
			}
		});
	}
	
	private void accept(final Npc npc, final Player owner) {
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Ok I just need to do a brief search"}) {
			public void finished() {
				owner.sendMessage("The monk searches you...");
				if(owner.getInventory().containsViolentEquipment()) {
					World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Sorry but we do not allow weapons on our holy island"}) {
						public void finished() {
							owner.setBusy(false);
							npc.unblock();
						}
					});
				}
				else
				World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Enjoy your time on entrana"}) {
						public void finished() {
						owner.sendMessage("You board the ship..");
						/*
						 * User attempting to spam click pick-up
						 * items, and smuggle them on the ship
						 * (Potential Fix)...
						 */
						if(owner.getInventory().containsViolentEquipment())
						{
							owner.sendMessage("You were kicked off the ship, due to trying to sneak weapons on the holy Island of Entrana");
							owner.setBusy(false);
							npc.unblock();
							return;
						}
						owner.teleport(418, 570, false);
						owner.sendMessage("..And arrive at Entrana");
						owner.setBusy(false);
						npc.unblock();
						}
				});
			}
		});
	}
	
	private void decline(final Npc npc, final Player owner) {
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"May saradomin watch over you"}) {
			public void finished() {
				owner.setBusy(false);
				npc.unblock();
			}
		});
	}
	
	
	
	
										
	
}