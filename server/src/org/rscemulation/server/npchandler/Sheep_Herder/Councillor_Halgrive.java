/**
* Generated By NPCScript :: A scripting engine created for RSCEmulation by Zilent
* INSERT INTO `cconfig`.`conf_npc` (`npc_id`, `class_name`, `id`) VALUES ('436', 'org.rscemulation.server.npchandler.Sheep_Herder.Councillor_Halgrive', NULL);
*/
package org.rscemulation.server.npchandler.Sheep_Herder;
import org.rscemulation.server.event.SingleEvent;
import org.rscemulation.server.model.InvItem;
import org.rscemulation.server.model.Npc;
import org.rscemulation.server.model.ChatMessage;
import org.rscemulation.server.model.MenuHandler;
import org.rscemulation.server.model.Quest;
import org.rscemulation.server.model.World;
import org.rscemulation.server.event.DelayedQuestChat;
import org.rscemulation.server.model.Player;
import org.rscemulation.server.npchandler.NpcHandler;
public class Councillor_Halgrive implements NpcHandler {
	public void handleNpc(final Npc npc, final Player owner) throws Exception {
		npc.blockedBy(owner);
		owner.setBusy(true);
		Quest q = owner.getQuest(34);
		if (q != null) {
			switch (q.getStage()) {
			case 0:
			
			}
		} else {
			notStarted(npc, owner);
		}
	}
	private void notStarted(final Npc npc, final Player owner) {
		World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"How are you?"}, true) {
			public void finished() {
				World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"I've been better"}) {
					public void finished() {
						World.getDelayedEventHandler().add(new SingleEvent(owner, 1500) {
							public void action() {
								final String[] options16 = {"What's wrong?", "That's life for you"};
								owner.setBusy(false);
								owner.sendMenu(options16);
								owner.setMenuHandler(new MenuHandler(options16) {
									public void handleReply(final int option, final String reply) {
										owner.setBusy(true);
										for(Player informee : owner.getViewArea().getPlayersInView()) {
											informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
										}
										switch(option) {
											case 0:
												whatsWrong(npc, owner);
												break;
											case 1:
												owner.setBusy(false);
												npc.unblock();
												break;
										}
									}
								});
							}
						});
					}
				});
			}
		});
	}
	private void whatsWrong(final Npc npc, final Player owner) {
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"A plague has spread over west ardounge", "apparently it's reasonably contained", "but four infected sheep have escaped", "they're roaming free in and around east ardounge", "the whole city could be infected in days", "I need someone to gather the sheep", "herd them into a safe enclosure", "then kill the sheep", "their remains will also need to be disposed of safely in a furnace"}) {
			public void finished() {
				World.getDelayedEventHandler().add(new SingleEvent(owner, 1500) {
					public void action() {
						final String[] options17 = {"I can do that for you", "That's not a job for me"};
						owner.setBusy(false);
						owner.sendMenu(options17);
						owner.setMenuHandler(new MenuHandler(options17) {
							public void handleReply(final int option, final String reply) {
								owner.setBusy(true);
								for(Player informee : owner.getViewArea().getPlayersInView()) {
									informee.informOfChatMessage(new ChatMessage(owner, reply, npc));
								}
								switch(option) {
									case 0:
										doThat(npc, owner);
										break;
									case 1:
										World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Fair enough, it's not nice work"}) {
											public void finished() {
												owner.setBusy(false);
												npc.unblock();
											}
										});
										break;
								}
							}
						});
					}
				});
			}
		});
	}
	private void doThat(final Npc npc, final Player owner) {
		World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Good, the enclosure is to the north of the city", "on farmer Brumpty's farm", "the four sheep should still be close to it", "before you go into the enclosure", "make sure you have protective clothing on", "otherwise you'll catch the plague"}) {
			public void finished() {
				World.getDelayedEventHandler().add(new DelayedQuestChat(owner, npc, new String[] {"where do I get protective clothing?"}) {
					public void finished() {
						World.getDelayedEventHandler().add(new DelayedQuestChat(npc, owner, new String[] {"Doctor Orbon wears it when trying to save the infected", "you'll find him in the chapel", "take this poisioned animal feed", "give it to the four sheep and they'll peacefully fall asleep"}) {
							public void finished() {
								owner.sendMessage("The councillor gives you some sheep poison");
								owner.getInventory().add(new InvItem(759, 1));
								owner.sendInventory();
								owner.addQuest(34,4);
								owner.setBusy(false);
								npc.unblock();
								
							}
						});
					}
				});
			}
		});
	}
}